{% extends "_base.html" %}
{% block content %}
<div class="row">
	<div class="col-lg-12 animatedParent animateOnce z-index-50">
		<div class="panel panel-default animated fadeInUp go">
			<div class="panel-heading clearfix">
				<h3 class="panel-title">مراجعة و تحيين الملك البلدي</h3>
				<ul class="panel-tool-options"> 
					<li><a data-rel="collapse" href="#"><i class="icon-down-open"></i></a></li>
					<li><a data-rel="reload" href="#"><i class="icon-arrows-ccw"></i></a></li>
					<li><a data-rel="close" href="#"><i class="icon-cancel"></i></a></li>
				</ul>
					<br><br>
		<div class='row'>
			<div class='col-lg-4'></div>
			<div class='col-lg-3'>
				<div class="panel panel-danger animated fadeInUp go" id='DeleteDetention' style="display: none;">
					<div class="panel-heading clearfix"> 
						<div class="panel-title">تأكيد الحذف ؟؟</div> 
						<ul class="panel-tool-options"> 
						</ul>  
					</div>
					<div class="panel-body">
						<div class='row'>
							<div class='col-sm-6'>
								<form action="/consult_municipal_property" method="POST">
								<input class="btn btn-outline btn-red btn-block" type="submit" value='نعم'/>
								<input type="hidden" id='DelId' name="type" value="">
								<input type="hidden" id='del_row' name="delete_row" value="">
							</form>
							</div>
							<div class='col-sm-6'>
								<a href="/consult_municipal_property" class="btn btn-outline btn-primary btn-block" type="submit">لا</a>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class='col-lg-5'></div>
		</div>
			</div>
			<div class="panel-body">
				<div class='row'>
					<div class="col-lg-4">
						
						<div id="DataTables_Table_0_filter" class="dataTables_filter"><label>البحث عن طريق الترسيم العقاري
							<input type="search" class="form-control input" placeholder="" aria-controls="DataTables_Table_0" id="myInput" onkeyup="myFunction()" >
						</label>
					</div>
				
				<div>
					<form method="get" action="/add_municipal_property">
						<button class="btn btn-blue" type="submit"><i class="fa fa-plus"></i>&nbsp;إضافة ملك بلدي جديد</button>
					</form>
				</div>
			</div>
			<div class="col-lg-8">
				<div class='row'>
					<div class="col">
						<form action = "/get_property_file" method = "POST" enctype = "multipart/form-data",>
							<input class="btn btn-outline btn-success btn-block" type="submit" value='إستخراج الملفات'/>
							<input type='hidden' name='type_file' value='en_cours'>
						</form>
						{% if file %}
						<div class='row'>
							<div class='col-sm-2'>
								<label class="control-label">
									<strong>الملك الخاص</strong>
								</label>
							</div>
							<div class='col-sm-7'>
								<input type="text" class="form-control has-success" placeholder="{{ private_url }}", readonly/>
							</div>
							<div class='col-sm-3'>
								<p id ="copy_link_encours" style="display: none;">{{ private_url }}</p>
								<input class="btn btn-link btn-outline btn-block" type="button" value='نسخ الرابط' onclick="copyToClipboard('#copy_link_encours')"/>
							</div>
						</div>
						<div class="line-dashed"></div>
						<div class='row'>
							<div class='col-sm-2'>
								<label class="control-label">
									<strong>الملك العام</strong>
								</label>
							</div>
							<div class='col-sm-7'>
								<input type="text" class="form-control has-success" placeholder="{{ public_url }}", readonly/>
							</div>
							<div class='col-sm-3'>
								<p id ="copy_link_encours" style="display: none;">{{ public_url }}</p>
								<input class="btn btn-link btn-outline btn-block" type="button" value='نسخ الرابط' onclick="copyToClipboard('#copy_link_encours')"/>
							</div>
						</div>
						{% endif %}
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="table-responsive">
		<table class="table table-striped table-bordered table-hover dataTables-example" id="myTable">
			<thead>

				<tr>
					<th>صفة الملك</th>
					<th>الترسيم العقاري</th>
					<th>نوع الملك</th>
					<th>طريقة الإستغلال</th>
					<th>العنوان</th>
					<th>المستغل</th>
					<th>المساحة بالمتر ² </th>
					<th>Longitude</th>
					<th>Laltitude</th>
					<th>تحيين</th>
					<th>حذف</th>

				</tr>
			</thead>
			<tbody>
				{% for d in data %}
				<tr class="gradeA">
					<td>{{d['Type_Proprety']}}</td>
					<td>{{d['Titre_Foncier']}}</td>
					<td>{{d['Type_du_Bien']}}</td>
					<td>{{d['Type_Usage']}}</td>
					<td>{{d['Adresse_Localisation']}}</td>
					<td>{{d['Mode_Octroi']}}</td>
					<td>{{d['Surface']}}</td>
					<td>{{d['Longitude']}}</td>
					<td>{{d['Laltitude']}}</td>
					<form action="/update_municipal_property" method="POST">
						<td>
							<input type="hidden" name="type" value="{{d['id']}}">
							<button class="btn btn-link btn-outline btn-block" type="submit" value=''><i class="fa fa-edit"></i></button>
						</td>
					</form>
					<td>
						<button id='btndel' class="btn btn-red" value="{{d['id']}}" type="button" onclick="DeleteFunction({{d['id']}})"><span class="glyphicon glyphicon-trash"></span></button>
						<p id="id_input" style='display:none;'>{{d['id']}}</p>
					</td>
			</tr>
			{% endfor %}
		</tbody>
		<tfoot>
			<tr>
				<th>صفة الملك</th>
				<th>الترسيم العقاري</th>
				<th>نوع الملك</th>
				<th>طريقة الإستغلال</th>
				<th>العنوان</th>
				<th>المستغل</th>
				<th>المساحة بالمتر ² </th>
				<th>Longitude</th>
				<th>Laltitude</th>
				<th>تحيين</th>
				<th>حذف</th>
			</tr>
		</tfoot>
	</table>
</div>
</div>
</div>
</div>
</div>
{% block js %}
<script>
function DeleteFunction(element){
	$('#DeleteDetention').css({
			'display': 'block',
		})
	$('#DelId').val(element)
	$('#del_row').val(document.getElementById("ref_del").value) 
}
// function DeleteFunction(id) {
// 	var r = confirm("تأكيد الحذف ؟؟");
// 	if (r == true) {
// 		$.post( "/consult_municipal_property", {
// 			delete_row: 'delete_row',
// 			type : id
// 		});		
// 		location.reload(true)
// 	}
// }
function myFunction() {
	var input, filter, table, tr, td, i;
	input = document.getElementById("myInput");
	filter = input.value.toUpperCase();
	table = document.getElementById("myTable");
	tr = table.getElementsByTagName("tr");
	for (i = 0; i < tr.length; i++) {
		td = tr[i].getElementsByTagName("td")[1];
		if (td) {
			if (td.innerHTML.toUpperCase().indexOf(filter) > -1) {
				tr[i].style.display = "";
			} else {
				tr[i].style.display = "none";
			}
		}       
	}
}
function copyToClipboard(element) {
	var $temp = $("<input>");
	$("body").append($temp);
	$temp.val($(element).text()).select();
	document.execCommand("copy");
	$temp.remove();
}
</script>
{% endblock %}
{% endblock %}
