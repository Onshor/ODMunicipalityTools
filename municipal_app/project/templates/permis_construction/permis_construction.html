{% extends "_base.html" %}
{% block content %}
<div class="row">
	<div class="col-lg-12 animatedParent animateOnce z-index-50">
		<div class="panel panel-default animated fadeInUp go">
			<div class="panel-heading clearfix">
				<h3 class="panel-title">مراجعة و تحيين الرخص</h3>
				<ul class="panel-tool-options"> 
					<li><a data-rel="collapse" href="#"><i class="icon-down-open"></i></a></li>
					<li><a data-rel="reload" href="#"><i class="icon-arrows-ccw"></i></a></li>
					<li><a data-rel="close" href="#"><i class="icon-cancel"></i></a></li>
				</ul>
			</div>
			<div class="panel-body">
				<div class='row'>
					<div class="col-lg-4">
						<div id="DataTables_Table_0_filter" class="dataTables_filter"><label>البحث عن طريق رقم بطاقة التعريف أو بطاقة الاقامة للاجانب
							<input type="search" class="form-control input-sm" placeholder="" aria-controls="DataTables_Table_0" id="myInput" onkeyup="myFunction()" >
						</label>
					</div>
					<div>
						<form method="get" action="/permisconst">
							<button class="btn btn-default btn-outline" type="submit">إضافة ترخيص جديد</button>
						</form>
					</div>
				</div>
				<div class="col-lg-8">
					<div class='row'>
						<h3 class="panel-title text-center">إستخراج الملفات</h3>
					</div>
					<div class="line-dashed"></div>
					<div class='row'>
						<div class="col-lg-4">
							<form action = "/get_files" method = "POST" enctype = "multipart/form-data",>
								<input class="btn btn-primary btn-outline btn-block" type="submit" value='ملف الرخص بصدد الدرس'/>
								<input type='hidden' name='type_file' value='en_cours'>
							</form>
							{% if encours %}
							<input type="text" class="form-control has-success" placeholder="{{ encour_url }}", readonly/>
							<p id ="copy_link_encours" style="display: none;">{{ encour_url }}</p>
							<input class="btn btn-link btn-outline btn-block" type="button" value='نسخ الرابط' onclick="copyToClipboard('#copy_link_encours')"/>
							{% endif %}
						</div>
						<div class="col-lg-4">
							<form action = "/get_files" method = "POST" enctype = "multipart/form-data",>
								<input class="btn btn-success btn-outline btn-block" type="submit" value='ملف الرخص المقبولة'/>
								<input type='hidden' name='type_file' value='approved'>
							</form>
							{% if approved %}
							<input type="text" class="form-control has-success" placeholder="{{ approved_url }}", readonly/>
							<p id ="copy_link_approved" style="display: none;">{{ approved_url }}</p>
							<input class="btn btn-link btn-outline btn-block" type="button" value='نسخ الرابط' onclick="copyToClipboard('#copy_link_approved')"/>
							{% endif %}
						</div>
						<div class="col-lg-4">
							<form action = "/get_files" method = "POST" enctype = "multipart/form-data",>
								<input class="btn btn-red btn-outline btn-block" type="submit" value='ملف الرخص المرفوضة'/>
								<input type='hidden' name='type_file' value='refused'>
							</form>
							{% if refused %}
							<input type="text" class="form-control has-success" placeholder="{{ refused_url }}", readonly/>
							<p id ="copy_link_refused" style="display: none;">{{ refused_url }}</p>
							<input class="btn btn-link btn-outline btn-block" type="button" value='نسخ الرابط' onclick="copyToClipboard('#copy_link_refused')"/>
							{% endif %}
						</div>
					</div>
				</div>
			</div>
			<div class="table-responsive">
				<table class="table table-striped table-bordered table-hover dataTables-example" id="myTable">
					<thead>
						<tr>
							<th>رقم تسلسلي</th>
							<th>رقم المطلب</th>
							<th>صاحب الرخصة</th>
							<th>رقم بطاقة التعريف أو بطاقة الاقامة للاجانب</th>
							<th>العنوان</th>
							<th>نوع البناء</th>
							<th>الوضعيّة</th>
							<th></th>
						</tr>
					</thead>
					<tbody>
						{% for d in data %}
						<tr class="gradeA">
							<td>{{d['id']}}</td>
							<td>{{d['num_demande']}}</td>
							<td>{{d['nom_titulaire']}}</td>
							<td>{{d['num_cin']}}</td>
							<td>{{d['address']}}</td>
							<td>{{d['type_construct']}}</td>
							{% if d['permis_status'] == 'en_cours' %}
							<td ><h3><span class="badge badge-pill badge-primary"><strong>بصدد الدرس</strong></span></h3></td>
							{% elif d['permis_status'] == 'approved' %}
							<td ><h3><span class="badge badge-pill badge-success"><strong>الموافقة</strong></span></h3></td>
							{% else %}
							<td ><h3><span class="badge badge-pill badge-danger"><strong>الرفض</strong></span></h3></td>
							{%endif%}
							<form action="/update_permisconst" method="POST">
								<td>
									<input type="hidden" name="type" value={{d['id']}}>
									<input type="hidden" name="name" value="{{d['nom_titulaire']}}">
									<input class="btn btn-link btn-outline btn-block"type="submit" name='shit' value='تحيين'/>
								</td>
							</form>
						</tr>
						{% endfor %}
					</tbody>
					<tfoot>
						<tr>
							<th>رقم تسلسلي</th>
							<th>رقم المطلب</th>
							<th>صاحب الرخصة</th>
							<th>رقم بطاقة التعريف أو بطاقة الاقامة للاجانب</th>
							<th>العنوان</th>
							<th>نوع البناء</th>
							<th>الوضعيّة</th>
							<th></th>
						</tr>
					</tfoot>
				</table>
			</div>
		</div>
	</div>
</div>
</div>
{% block js %}
<script>
function myFunction() {
	var input, filter, table, tr, td, i;
	input = document.getElementById("myInput");
	filter = input.value.toUpperCase();
	table = document.getElementById("myTable");
	tr = table.getElementsByTagName("tr");
	for (i = 0; i < tr.length; i++) {
		td = tr[i].getElementsByTagName("td")[3];
		if (td) {
			if (td.innerHTML.toUpperCase().indexOf(filter) > -1) {
				tr[i].style.display = "";
			} else {
				tr[i].style.display = "none";
			}
		}       
	}
}
function copyToClipboard(element) {
	var $temp = $("<input>");
	$("body").append($temp);
	$temp.val($(element).text()).select();
	document.execCommand("copy");
	$temp.remove();
}
</script>
{% endblock %}
{% endblock %}