{% extends "_base.html" %}
{% block content %}
<h1 class="page-title">تراخيص البناء</h1>
<div class="panel panel-default animated fadeInUp go">
  <div class="panel-heading clearfix">
    <h3 class="panel-title">إضافة ترخيص جديد</h3>
    <ul class="panel-tool-options"> 
      <li><a data-rel="collapse" href="#"><i class="icon-down-open"></i></a></li>
      <li><a data-rel="reload" href="#"><i class="icon-arrows-ccw"></i></a></li>
    </ul>
  </div>

<div class="panel-body">
  <form class="form-horizontal" role="form" method="post" action="">
    {{ form.csrf_token }}
    <div class="form-group">
      <label class="col-sm-3 control-label">رقم المطلب</label> 
      <div class="col-sm-5">
        {{ form.num_demande( class="form-control",type="number") }}
        {% if form.num_demande.errors %}
        {% for error in form.num_demande.errors %}
        <h5>هذه الخانة مطلوبه</h5>
        {% endfor %}
        {% endif %}
      </div> 
    </div>
    <div class="line-dashed"></div>
    <div class="form-group"> 
      <label class="col-sm-3 control-label">تاريخ إيداع المطلب</label> 
      <div class="col-sm-5">
        <div id="date-popup" class="input-group date">
          {{ form.date_depot( class="form-control", type="text") }}
          {% if form.date_depot.errors %}
          {% for error in form.date_depot.errors %}
          <h5>هذه الخانة مطلوبه و صيغة yyyy/mm/dd</h5>
          {% endfor %}
          {% endif %}
          <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
        </div>
      </div> 
    </div>
    <div class="line-dashed"></div>
    <div class="form-group"> 
      <label class="col-sm-3 control-label">إسم و لقب  صاحب الرخصة *</label> 
      <div class="col-sm-5">
        {{ form.nom_titulaire( class="form-control",type="text") }}
        {% if form.nom_titulaire.errors %}
        {% for error in form.nom_titulaire.errors %}
        <h5>هذه الخانة مطلوبه</h5>
        {% endfor %}
        {% endif %}
      </div> 
    </div>
    <div class="line-dashed"></div>
    <div class="form-group"> 
      <label class="col-sm-3 control-label">رقم بطاقة التعريف أو بطاقة الاقامة للاجانب *</label> 
      <div class="col-sm-5"> 
        {{ form.num_cin( class="form-control",type="text") }}
        {% if form.num_cin.errors %}
        {% for error in form.num_cin.errors %}
        <h5>هذه الخانة مطلوبه</h5>
        {% endfor %}
        {% endif %}
      </div> 
    </div>
    <div class="line-dashed"></div>
    <div class="form-group"> 
      <label class="col-sm-3 control-label">العنوان *</label> 
      <div class="col-sm-5"> 
        {{ form.address( class="form-control",type="text") }}
        {% if form.address.errors %}
        {% for error in form.address.errors %}
        <h5>هذه الخانة مطلوبه</h5>
        {% endfor %}
        {% endif %}
      </div> 
    </div>
    <div class="line-dashed"></div>
    <div class="form-group"> 
      <label class="col-sm-3 control-label">نوع البناء *</label> 
      <div class="col-sm-5"> 
        {{ form.type_construct( class="form-control",type="text") }}
        {% if form.type_construct.errors %}
        {% for error in form.type_construct.errors %}
        <h5>هذه الخانة مطلوبه</h5>
        {% endfor %}
        {% endif %}
      </div> 
    </div>
    <div class="line-dashed"></div>
    <div class="form-group"> 
      <label class="col-sm-3 control-label">وصف الأشغال</label> 
      <div class="col-sm-5"> 
        {{ form.desc_construct( class="form-control",type="text") }}
        {% if form.desc_construct.errors %}
        {% for error in form.desc_construct.errors %}
        <h5>هذه الخانة مطلوبه</h5>
        {% endfor %}
        {% endif %}
      </div> 
    </div>
    <div class="line-dashed"></div>
    <div class="form-group"> 
      <label class="col-sm-3 control-label">المساحة *</label> 
      <div class="col-sm-5"> 
        {{ form.surface( class="form-control") }}
        {% if form.surface.errors %}
        {% for error in form.surface.errors %}
        <h5>هذه الخانة مطلوبه</h5>
        {% endfor %}
        {% endif %}
      </div> 
    </div>
    <div class="line-dashed"></div>
    <div class="row">
      <div class='col-lg-6'>
        <div class='row'>
          <div class="form-group"> 
            <label class="col-sm-3 control-label">Longitude *</label> 
            <div class="col-sm-5">
              {{ form.longitude( class="form-control") }}
              {% if form.longitude.errors %}
              {% for error in form.longitude.errors %}
              <p style='color:red'>{{ error }}</p>
              {% endfor %}
              {% endif %}
            </div>
          </div>
        </div>
        <div class='row'>
          <div class="form-group">
            <label class="col-sm-3 control-label">Laltitude *</label> 
            <div class="col-sm-5">
              {{ form.latitude( class="form-control") }}
              {% if form.latitude.errors %}
              {% for error in form.latitude.errors %}
              <p style='color:red'>{{ error }}</p>
              {% endfor %}
              {% endif %}
            </div>
          </div>
        </div>
      </div>
      <div class_='col-lg-6'>
        <div id="mapid" style="width: 400px; height: 400px; position: relative; outline: none;" class="leaflet-container leaflet-touch leaflet-fade-anim leaflet-grab leaflet-touch-drag leaflet-touch-zoom" tabindex="0">
          <div class="leaflet-pane leaflet-map-pane" style="transform: translate3d(87px, 44px, 0px);">
            <div class="leaflet-pane leaflet-tile-pane">
              <div class="leaflet-layer " style="z-index: 1; opacity: 1;"><div class="leaflet-tile-container leaflet-zoom-animated" style="z-index: 18; transform: translate3d(0px, 0px, 0px) scale(1);"></div></div></div><div class="leaflet-pane leaflet-shadow-pane"></div><div class="leaflet-pane leaflet-overlay-pane"></div><div class="leaflet-pane leaflet-marker-pane"></div><div class="leaflet-pane leaflet-tooltip-pane"></div><div class="leaflet-pane leaflet-popup-pane"></div><div class="leaflet-proxy leaflet-zoom-animated" style="transform: translate3d(1.04796e+06px, 697335px, 0px) scale(4096);"></div></div><div class="leaflet-control-container"><div class="leaflet-top leaflet-left"><div class="leaflet-control-zoom leaflet-bar leaflet-control"><a class="leaflet-control-zoom-in" href="#" title="Zoom in" role="button" aria-label="Zoom in">+</a><a class="leaflet-control-zoom-out" href="#" title="Zoom out" role="button" aria-label="Zoom out">−</a></div></div><div class="leaflet-top leaflet-right"></div><div class="leaflet-bottom leaflet-left"></div><div class="leaflet-bottom leaflet-right"><div class="leaflet-control-attribution leaflet-control"><a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> | Map data © <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a></div></div></div></div>
            </div>
          </div>
          <div class="line-dashed"></div>
          <div class="row">
            <div class="col-sm-8"></div>
            <div class="col-sm-2">
              <button class="btn btn-primary btn-block" type="submit">حفظ</button>
            </div>
            <div class="col-sm-2">
              <a href='/consult_permisconst' class="btn btn-red btn-block" type="submit">إلغاء</a>
            </div>
          </div>
        </form>
      </div>
    </div>

  </div>
</form>
</div>
</div>
{% endblock %}
{% block js %}

<script>
$(document).ready(function()
{
  $('#btnEdit').click(function()
  {
    $("input[id='maj']").removeAttr("readonly")
    $("div[id=save_encours]").removeAttr('style')
    $('#btnEdit').css({
      'display': 'none',
    });  
  });

});

    
    var mymap = L.map('mapid').setView({{mun_cord}}, 15);
    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
      maxZoom: 18,
      attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
      '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
      'Imagery © <a href="http://mapbox.com">Mapbox</a>',
      id: 'mapbox.streets'
    }).addTo(mymap);
    // L.marker({{mun_cord}}).addTo(mymap)
    // .bindPopup("<b>{{mun_name}} بلدية</b><br />").openPopup();

    var marker = L.marker({{mun_cord}}, {
              draggable:true
            }).addTo(mymap);

    marker.on('dragend', function (e) {
        document.getElementById('latitude').value = marker.getLatLng().lat;
        document.getElementById('longitude').value = marker.getLatLng().lng;
    });

    var popup = L.popup();
// var mymap = L.map('mapid').setView({{mun_cord}}, 15);
// L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
//   maxZoom: 18,
//   attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
//   '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
//   'Imagery © <a href="http://mapbox.com">Mapbox</a>',
//   id: 'mapbox.streets'
// }).addTo(mymap);

// L.marker({{mun_cord}}).addTo(mymap)
// .bindPopup("<b>{{mun_name}} بلدية</b><br />").openPopup();




// var popup = L.popup();

// function onMapClick(e) {
//   document.getElementById('Laltitude').value = e.latlng.lat.toString();
//   document.getElementById('Longitude').value = e.latlng.lng.toString();
//   popup
//   .setLatLng(e.latlng)
//   .setContent("<i class='fa fa-map-marker'/>" + e.latlng.toString())
//   .openOn(mymap);
// }

// mymap.on('click', onMapClick);

// mymap.on('click', onMapClick);
// var map = L.map('mapid').setView({{mun_cord}}, 13);
// var my_divicon = L.divIcon({
//     className: 'arrow_box'
// });
// var marker = L.marker([51.5, -0.09], {
//     draggable:true
// });
// function addToTextBox(lt,ln){
//     document.getElementById('lat').innerHTML = lt;
//     document.getElementById('lng').innerHTML = ln;
    
// }
// marker.on('dragend', function(event){
//     //alert('drag ended');
//     var marker = event.target;
//     var location = marker.getLatLng();
//     var lat = location.lat;
//     var lon = location.lng;
//     addToTextBox(lat,lon);
//     //alert(lat);
//     //retrieved the position
//   });

// marker.addTo(map);

$(document).ready(function()
{
 $('#btnEdit').click(function()
 {
   $("input[id='maj']").removeAttr("readonly")
   $("div[id=save_encours]").removeAttr('style')
   $('#accept_buttom').css({
    'display': 'none',
  })
   $('#refuse_buttom').css({
    'display': 'none',
  });  
 });

});
$(document).ready(function()
{
 $('#accept_buttom').click(function()
 {
   $('#btnEdit').css({
    'display': 'none',
  })
   $('#refuse_buttom').css({
    'display': 'none',
  });  
 });

});
$(document).ready(function () {
  $('#datepicker').datepicker({
    keyboardNavigation: false,
    forceParse: false,
    todayHighlight: true
  });

  $('#date-popup').datepicker({
    keyboardNavigation: false,
    forceParse: false,
    todayHighlight: true,
    format: "yyyy/mm/dd"
  });

  $('#year-view').datepicker({
    startView: 2,
    keyboardNavigation: false,
    forceParse: false,
    format: "yyyy/mm/dd"
  });

  
});
var mymap = L.map('mapid').setView({{mun_cord}}, 15);
    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
      maxZoom: 18,
      attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
      '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
      'Imagery © <a href="http://mapbox.com">Mapbox</a>',
      id: 'mapbox.streets'
    }).addTo(mymap);

    L.marker({{mun_cord}}).addTo(mymap)
    .bindPopup("<b>{{mun_name}} بلدية</b><br />").openPopup();




    var popup = L.popup();

    function onMapClick(e) {
      document.getElementById('Laltitude').value = e.latlng.lat.toString();
      document.getElementById('Longitude').value = e.latlng.lng.toString();
      popup
      .setLatLng(e.latlng)
      .setContent("<i class='fa fa-map-marker'/>" + e.latlng.toString())
      .openOn(mymap);
    }

    mymap.on('click', onMapClick);

</script>


{% endblock %}