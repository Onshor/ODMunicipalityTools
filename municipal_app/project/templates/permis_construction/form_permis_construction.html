{% extends "_base.html" %}
{% block content %}
<h1 class="page-title">تراخيص البناء</h1>
<div class="panel panel-default animated fadeInUp go">
  <div class="panel-heading clearfix">
    {% if update %}
    <h3 class="panel-title"> تحيين الرخص {{ name }}</h3>
    {% else %}
    <h3 class="panel-title">إضافة ترخيص جديد</h3>
    {% endif %}
    <ul class="panel-tool-options"> 
      <li><a data-rel="collapse" href="#"><i class="icon-down-open"></i></a></li>
      <li><a data-rel="reload" href="#"><i class="icon-arrows-ccw"></i></a></li>
    </ul>
  </div>
  {% if update %}
  <div class="panel-body">
    <form action="/update_permisconst" method="POST">
      <div class="form-group">
        <div class="row">
          <div class="col-md-4">إسم و لقب صاحب الرخصة<div class="form-group-inner"><input type="text" class="form-control"  placeholder="" name='nom_titulaire' value='{{permis_data.nom_titulaire}}' id ="maj" readonly></div></div>
          <div class="col-md-4">رقم المطلب<div class="form-group-inner"><input type="text" class="form-control" placeholder="" name='num_demande' value='{{permis_data.num_demande}}' id ="maj" readonly></div></div>
          <div class="col-md-4">رقم بطاقة التعريف أو بطاقة الاقامة للاجانب<div class="form-group-inner"><input type="text" class="form-control" placeholder="" id ="maj" value='{{permis_data.num_cin}}' readonly></div></div>
        </div>                    
        <div class="row">
          <div class="col-md-4">العنوان<div class="form-group-inner"><input type="text" class="form-control" placeholder="" name='address' value='{{permis_data.address}}' id ="maj" readonly></div></div>
          <div class="col-md-4">وصف الأشغال<div class="form-group-inner"><input type="text" class="form-control" placeholder="" name='desc_construct' value='{{permis_data.desc_construct}}' id ="maj" readonly></div></div>
          <div class="col-md-4">نوع البناء<div class="form-group-inner"><input type="text" class="form-control" placeholder="" value='{{permis_data.type_construct}}' id ="maj" readonly></div></div>
        </div>
        <div class="row">
          <div class="col-md-4">تاريخ إيداع المطلب<div class="form-group-inner"><input type="text" class="form-control" placeholder="" name='date_depot' value='{{permis_data.date_depot}}' id ="maj" readonly></div></div>
          <div class="col-md-4">longitude<div class="form-group-inner"><input type="text" class="form-control" placeholder="" name='longitude' value='{{permis_data.longitude}}' id ="maj" readonly></div></div>
          <div class="col-md-4">laltitude<div class="form-group-inner"><input type="text" class="form-control" placeholder="" name='laltitude' value='{{permis_data.laltitude}}' id ="maj" readonly></div></div>
          <div class="col-md-4"></div>
        </div>
        
        <div class="form-group" id='save_encours' style="display:none">
         <div class="col-sm-6">
           <button class="btn btn-primary btn-block" type="submit">حفظ</button>
           <input type="hidden" name="type" value={{permis_id}}>
           <input type="hidden" name="name" value="{{name}}">
         </div>
         <div class="col-sm-6">
           <a href='/consult_permisconst' class="btn btn-red btn-block" type="submit">إلغاء</a>
         </div>
       </div>

     </div>
   </form>
 </div>
 <input class="btn btn-info btn-outline btn-block" name='button' id="btnEdit" type="submit" value= 'تحيين الرخصة'>
 <div class="line-dashed"></div>
 <form action="/accept_permisconst" method="POST">
  <input id='accept_buttom' class="btn btn-success btn-outline btn-block" name='button' type="submit" value= 'قبول الرخصة'>
  <input type="hidden" name="type" value={{permis_id}}>
  <input type="hidden" name="name" value="{{name}}">
</form>
<form action="/refuse_permisconst" method="POST">
  <input id='refuse_buttom' class="btn btn-red btn-outline btn-block" type='submit' name='button' value='رفض الرخصة'>
  <input type="hidden" name="type" value={{permis_id}}>
  <input type="hidden" name="name" value="{{name}}">
</form>
{% if check %}
{% if accept %}
<form class="form-horizontal" role="form" method="post" action="">
  {{ form.csrf_token }}
  <div class="form-group">
    <label class="col-sm-3 control-label">عدد قرار رخصة البناء *</label> 
    <div class="col-sm-5">
      {{ form.num_permis( class="form-control",type="number") }}
      {% if form.num_permis.errors %}
      {% for error in form.num_permis.errors %}
      <h5>هذه الخانة مطلوبه</h5>
      {% endfor %}
      {% endif %}
    </div> 
  </div>
  <div class="line-dashed"></div>
  <div class="form-group"> 
    <label class="col-sm-3 control-label">تاريخ اسناد الرخصة *</label> 
    <div class="col-sm-5">
      {{ form.date_attribution( class="form-control", type="text", placeholder='صيغة yyyy/mm/dd') }}
      {% if form.date_attribution.errors %}
      {% for error in form.date_attribution.errors %}
      <h5>هذه الخانة مطلوبه و صيغة yyyy/mm/dd</h5>
      {% endfor %}
      {% endif %}
    </div> 
  </div>
  <div class="line-dashed"></div>
  <div class="form-group"> 
    <label class="col-sm-3 control-label">تاريخ انتهاء الصلوحيّة *</label> 
    <div class="col-sm-5">
      {{ form.date_expiration( class="form-control", type="text", placeholder='صيغة yyyy/mm/dd') }}
      {% if form.date_expiration.errors %}
      {% for error in form.date_expiration.errors %}
      <h5>هذه الخانة مطلوبه و صيغة yyyy/mm/dd</h5>
      {% endfor %}
      {% endif %}
    </div> 
  </div>
  <div class="line-dashed"></div>
  <div class="form-group"> 
    <label class="col-sm-3 control-label">معلوم قار</label> 
    <div class="col-sm-5">
      {{ form.mont_charge_fix( class="form-control", type="number", placeholder='', value='0') }}
      {% if form.mont_charge_fix.errors %}
      {% for error in form.mont_charge_fix.errors %}
      {{ error }}
      {% endfor %}
      {% endif %}
    </div>
  </div>
  <div class="line-dashed"></div>
  <div class="form-group"> 
    <label class="col-sm-3 control-label">قرار الترخيص</label> 
    <div class="col-sm-5">
      {{ form.mont_decision( class="form-control", type="number", placeholder='', value='0') }}
      {% if form.mont_decision.errors %}
      {% for error in form.mont_decision.errors %}
      {{ error }}
      {% endfor %}
      {% endif %}
    </div>
  </div>
  <div class="line-dashed"></div>
  <div class="form-group"> 
    <label class="col-sm-3 control-label">سياج</label> 
    <div class="col-sm-5">
      {{ form.mont_cloture( class="form-control", type="number", placeholder='', value='0') }}
      {% if form.mont_cloture.errors %}
      {% for error in form.mont_cloture.errors %}
      {{ error }}
      {% endfor %}
      {% endif %}
    </div>
  </div>
  <div class="line-dashed"></div>
  <div class="form-group"> 
    <label class="col-sm-3 control-label">معلوم تصاعدي</label> 
    <div class="col-sm-5">
      {{ form.mont_charge_ascend( class="form-control", type="number",  placeholder='', value='0') }}
      {% if form.mont_charge_ascend.errors %}
      {% for error in form.mont_charge_ascend.errors %}
      {{ error }}
      {% endfor %}
      {% endif %}
    </div>
  </div>
  <div class="form-group" id='save'>
   <div class="col-sm-6">
     <button class="btn btn-primary btn-block" type="submit">حفظ</button>
     <input type="hidden" name="type" value={{permis_id}}>
     <input type="hidden" name="name" value="{{name}}">
   </div>
   <div class="col-sm-6">
     <a href='/consult_permisconst' class="btn btn-red btn-block" type="submit">إلغاء</a>
   </div>
 </div>
</form>
{% else %}
<form class="form-horizontal" role="form" method="post" action="">
  {{ form.csrf_token }}
  <div class="form-group"> 
    <label class="col-sm-3 control-label">تاريخ الإعلام بالرفض *</label> 
    <div class="col-sm-5">
     {{ form.date_refuse( class="form-control", type="text", placeholder='صيغة yyyy/mm/dd', ) }}
     {% if form.date_refuse.errors %}
     {% for error in form.date_refuse.errors %}
     <h5>هذه الخانة مطلوبه و صيغة yyyy/mm/dd</h5>
     {% endfor %}
     {% endif %}
   </div> 
 </div>
 <div class="form-group" id='save'>
   <div class="col-sm-6">
     <button class="btn btn-primary btn-block" type="submit">حفظ</button>
     <input type="hidden" name="type" value={{permis_id}}>
     <input type="hidden" name="name" value="{{name}}">
   </div>
   <div class="col-sm-6">
     <a href='/consult_permisconst' class="btn btn-red btn-block" type="submit">إلغاء</a>
   </div>
 </div>
</form>  
{% endif %}
{% endif %}
</div>
{% else %}
<div class="panel-body">
  <form class="form-horizontal" role="form" method="post" action="">
    {{ form.csrf_token }}
    <div class="form-group">
      <label class="col-sm-3 control-label">رقم المطلب</label> 
      <div class="col-sm-5">
        {{ form.num_demande( class="form-control",type="number") }}
        {% if form.num_demande.errors %}
        {% for error in form.num_demande.errors %}
        <h5>هذه الخانة مطلوبه</h5>
        {% endfor %}
        {% endif %}
      </div> 
    </div>
    <div class="line-dashed"></div>
    <div class="form-group"> 
      <label class="col-sm-3 control-label">تاريخ إيداع المطلب *</label> 
      <div class="col-sm-5">
        {{ form.date_depot( class="form-control", type="text", placeholder='صيغة yyyy/mm/dd') }}
        {% if form.date_depot.errors %}
        {% for error in form.date_depot.errors %}
        <h5>هذه الخانة مطلوبه و صيغة yyyy/mm/dd</h5>
        {% endfor %}
        {% endif %}
      </div> 
    </div>
    <div class="line-dashed"></div>
    <div class="form-group"> 
      <label class="col-sm-3 control-label">إسم و لقب  صاحب الرخصة *</label> 
      <div class="col-sm-5">
        {{ form.nom_titulaire( class="form-control",type="text") }}
        {% if form.nom_titulaire.errors %}
        {% for error in form.nom_titulaire.errors %}
        <h5>هذه الخانة مطلوبه</h5>
        {% endfor %}
        {% endif %}
      </div> 
    </div>
    <div class="line-dashed"></div>
    <div class="form-group"> 
      <label class="col-sm-3 control-label">رقم بطاقة التعريف أو بطاقة الاقامة للاجانب *</label> 
      <div class="col-sm-5"> 
        {{ form.num_cin( class="form-control",type="text") }}
        {% if form.num_cin.errors %}
        {% for error in form.num_cin.errors %}
        <h5>هذه الخانة مطلوبه</h5>
        {% endfor %}
        {% endif %}
      </div> 
    </div>
    <div class="line-dashed"></div>
    <div class="form-group"> 
      <label class="col-sm-3 control-label">العنوان *</label> 
      <div class="col-sm-5"> 
        {{ form.address( class="form-control",type="text") }}
        {% if form.address.errors %}
        {% for error in form.address.errors %}
        <h5>هذه الخانة مطلوبه</h5>
        {% endfor %}
        {% endif %}
      </div> 
    </div>
    <div class="line-dashed"></div>
    <div class="form-group"> 
      <label class="col-sm-3 control-label">نوع البناء *</label> 
      <div class="col-sm-5"> 
        {{ form.type_construct( class="form-control",type="text") }}
        {% if form.type_construct.errors %}
        {% for error in form.type_construct.errors %}
        <h5>هذه الخانة مطلوبه</h5>
        {% endfor %}
        {% endif %}
      </div> 
    </div>
    <div class="line-dashed"></div>
    <div class="form-group"> 
      <label class="col-sm-3 control-label">وصف الأشغال</label> 
      <div class="col-sm-5"> 
        {{ form.desc_construct( class="form-control",type="text") }}
        {% if form.desc_construct.errors %}
        {% for error in form.desc_construct.errors %}
        <h5>هذه الخانة مطلوبه</h5>
        {% endfor %}
        {% endif %}
      </div> 
    </div>
    <div class="line-dashed"></div>
    <div class="row">
      <div class='col-lg-6'>
        <div class='row'>
          <div class="form-group"> 
            <label class="col-sm-3 control-label">Longitude *</label> 
            <div class="col-sm-5">
              {{ form.longitude( class="form-control") }}
              {% if form.longitude.errors %}
              {% for error in form.longitude.errors %}
              {{ error }}
              {% endfor %}
              {% endif %}
            </div>
          </div>
        </div>
        <div class='row'>
          <div class="form-group">
            <label class="col-sm-3 control-label">Laltitude *</label> 
            <div class="col-sm-5">
              {{ form.latitude( class="form-control") }}
              {% if form.latitude.errors %}
              {% for error in form.latitude.errors %}
              {{ error }}
              {% endfor %}
              {% endif %}
            </div>
          </div>
        </div>
      </div>
      <div class_='col-lg-6'>
        <div id="mapid" style="width: 600px; height: 400px; position: relative; outline: none;" class="leaflet-container leaflet-touch leaflet-fade-anim leaflet-grab leaflet-touch-drag leaflet-touch-zoom" tabindex="0">
          <div class="leaflet-pane leaflet-map-pane" style="transform: translate3d(87px, 44px, 0px);">
            <div class="leaflet-pane leaflet-tile-pane">
              <div class="leaflet-layer " style="z-index: 1; opacity: 1;"><div class="leaflet-tile-container leaflet-zoom-animated" style="z-index: 18; transform: translate3d(0px, 0px, 0px) scale(1);"><img alt="" role="presentation" src="https://api.tiles.mapbox.com/v4/mapbox.streets/13/4093/2723.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(56px, -91px, 0px); opacity: 1;"><img alt="" role="presentation" src="https://api.tiles.mapbox.com/v4/mapbox.streets/13/4094/2723.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(312px, -91px, 0px); opacity: 1;"><img alt="" role="presentation" src="https://api.tiles.mapbox.com/v4/mapbox.streets/13/4093/2724.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(56px, 165px, 0px); opacity: 1;"><img alt="" role="presentation" src="https://api.tiles.mapbox.com/v4/mapbox.streets/13/4094/2724.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(312px, 165px, 0px); opacity: 1;"><img alt="" role="presentation" src="https://api.tiles.mapbox.com/v4/mapbox.streets/13/4092/2723.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(-200px, -91px, 0px); opacity: 1;"><img alt="" role="presentation" src="https://api.tiles.mapbox.com/v4/mapbox.streets/13/4095/2723.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(568px, -91px, 0px); opacity: 1;"><img alt="" role="presentation" src="https://api.tiles.mapbox.com/v4/mapbox.streets/13/4092/2724.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(-200px, 165px, 0px); opacity: 1;"><img alt="" role="presentation" src="https://api.tiles.mapbox.com/v4/mapbox.streets/13/4095/2724.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(568px, 165px, 0px); opacity: 1;"></div></div></div><div class="leaflet-pane leaflet-shadow-pane"></div><div class="leaflet-pane leaflet-overlay-pane"></div><div class="leaflet-pane leaflet-marker-pane"></div><div class="leaflet-pane leaflet-tooltip-pane"></div><div class="leaflet-pane leaflet-popup-pane"></div><div class="leaflet-proxy leaflet-zoom-animated" style="transform: translate3d(1.04796e+06px, 697335px, 0px) scale(4096);"></div></div><div class="leaflet-control-container"><div class="leaflet-top leaflet-left"><div class="leaflet-control-zoom leaflet-bar leaflet-control"><a class="leaflet-control-zoom-in" href="#" title="Zoom in" role="button" aria-label="Zoom in">+</a><a class="leaflet-control-zoom-out" href="#" title="Zoom out" role="button" aria-label="Zoom out">−</a></div></div><div class="leaflet-top leaflet-right"></div><div class="leaflet-bottom leaflet-left"></div><div class="leaflet-bottom leaflet-right"><div class="leaflet-control-attribution leaflet-control"><a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> | Map data © <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a></div></div></div></div>
            </div>
          </div>
          <div class="form-group">
            <div class="col-sm-6">
              <button class="btn btn-primary btn-block" type="submit">حفظ</button>
            </div>
            <div class="col-sm-6">
              <a href='/consult_municipal_property' class="btn btn-red btn-block" type="submit">إلغاء</a>
            </div>
          </div>
        </form>
      </div>
    </div>

</div>
</form>
</div>
{% endif %}



{% block js %}

<script>
$(document).ready(function()
{
  $('#btnEdit').click(function()
  {
    $("input[id='maj']").removeAttr("readonly")
    $("div[id=save_encours]").removeAttr('style')
    $('#btnEdit').css({
      'display': 'none',
    });  
  });

});


var mymap = L.map('mapid').setView([36.35025049076684, 9.622135162353514], 15);
L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
  maxZoom: 18,
  attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
  '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
  'Imagery © <a href="http://mapbox.com">Mapbox</a>',
  id: 'mapbox.streets'
}).addTo(mymap);

L.marker([36.35025049076684, 9.622135162353514]).addTo(mymap)
.bindPopup("<b>{{mun_name}} بلدية</b><br />").openPopup();




var popup = L.popup();

function onMapClick(e) {
  document.getElementById('latitude').value = e.latlng.lat.toString();
  document.getElementById('longitude').value = e.latlng.lng.toString();
  popup
  .setLatLng(e.latlng)
  .setContent("<i class='fa fa-map-marker'/>" + e.latlng.toString())
  .openOn(mymap);
}

mymap.on('click', onMapClick);

$(document).ready(function()
{
 $('#btnEdit').click(function()
 {
   $("input[id='maj']").removeAttr("readonly")
   $("div[id=save_encours]").removeAttr('style')
   $('#accept_buttom').css({
    'display': 'none',
  })
   $('#refuse_buttom').css({
    'display': 'none',
  });  
 });

});
$(document).ready(function()
{
 $('#accept_buttom').click(function()
 {
   $('#btnEdit').css({
    'display': 'none',
  })
   $('#refuse_buttom').css({
    'display': 'none',
  });  
 });

});
$(document).ready(function () {
  $('#datepicker').datepicker({
    keyboardNavigation: false,
    forceParse: false,
    todayHighlight: true
  });

  $('#date-popup').datepicker({
    keyboardNavigation: false,
    forceParse: false,
    todayHighlight: true
  });

  $('#year-view').datepicker({
    startView: 2,
    keyboardNavigation: false,
    forceParse: false,
    format: "yyyy/mm/dd"
  });

  var dragFixed = document.getElementById('drag-fixed');
  noUiSlider.create(dragFixed, {
    start: [40, 60],
    behaviour: 'drag-fixed',
    connect: true,
    range: {
      'min': 20,
      'max': 80
    }
  });

  var basicSlider = document.getElementById('basic-slider');
  noUiSlider.create(basicSlider, {
    start: 40,
    behaviour: 'tap',
    connect: 'upper',
    range: {
      'min': 20,
      'max': 80
    }
  });

  var rangeSlider = document.getElementById('range-slider');
  noUiSlider.create(rangeSlider, {
    start: [40, 60],
    behaviour: 'drag',
    connect: true,
    range: {
      'min': 20,
      'max': 80
    }
  });

  $(".select2").select2();
  $(".select2-placeholer").select2({
    allowClear: true
  });

    //$('.colorpicker').colorpicker();

    // Colorpicker
    if ($.isFunction($.fn.colorpicker))
    {
      $(".colorpicker").each(function (i, el)
      {
        var $this = $(el);
        var  opts = {
              //format: attrDefault($this, 'format', false)
            };
            var $nextEle = $this.next();
            var $prevEle = $this.prev();
            var $colorPreview = $this.siblings('.input-group-addon').find('.icon-color-preview');

            $this.colorpicker(opts);

            if ($nextEle.is('.input-group-addon') && $nextEle.has('span'))
            {
              $nextEle.on('click', function (ev)
              {
                ev.preventDefault();
                $this.colorpicker('show');
              });
            }

            if ($prevEle.is('.input-group-addon') && $prevEle.has('span'))
            {
              $prevEle.on('click', function (ev)
              {
                ev.preventDefault();
                $this.colorpicker('show');
              });
            }

            if ($colorPreview.length)
            {
              $this.on('changeColor', function (ev) {

                $colorPreview.css('background-color', ev.color.toHex());
              });

              if ($this.val())
              {
                $colorPreview.css('background-color', $this.val());
              }
            }
          });
}
});
</script>
{% endblock %}

{% endblock %}